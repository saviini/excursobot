# Product Requirements Document (PRD)

## 1. Overview / Problem
**Цель.** Минимальный MVP телеграм-бота: при отправке пользователем локации бот посылает координаты в модель `gpt-4.1-mini` и возвращает **один короткий необычный факт** о любом месте рядом с этой локацией.  
**Проблема.** Нужно быстро (за один вечер) получить рабочий, надёжный и простой прототип без лишних интеграций и хранения данных.

## 2. Key User Flows
1. Пользователь отправляет статическую локацию → бот получает `message.location` (latitude, longitude) → формирует prompt → отправляет в OpenAI → получает факт → отправляет пользователю текст (1–2 предложения) и ссылку на карту.  
2. (v1.1) Пользователь делится **живой локацией** (live location) → пока live активна, бот каждые ~10 минут генерирует и шлёт новый факт (или обновляет сообщение). Пользователь может остановить рассылку командой `/stop`.

## 3. Functional Requirements
**MVP (v1.0):**
- Приём статической локации: чтение `latitude` и `longitude`.
- Отправка запроса в OpenAI `gpt-4.1-mini` с ограниченным промптом (ответ на русском, 1–2 предложения, указать название места и по возможности расстояние).
- Отправка результата в чат через `sendMessage`.
- Обработка ошибок и понятные сообщения об ошибке.
- Конфигурация через env vars: `TELEGRAM_TOKEN`, `OPENAI_API_KEY`, `WEBHOOK_URL`/флаг POLLING.
- Лёгкое логирование (получена локация, вызов OpenAI, ответ, ошибки).

**v1.1 (live location):**
- Детектирование `live_period` и обработка edited live-location updates.
- Механизм отправки нового факта каждые 10 минут для активной live-локации.
- Команда `/stop` для немедленного прекращения рассылки.
- Ограничение частоты (rate limit) на чат — чтобы избежать спама.

## 4. Non-Goals
- Не интегрировать в MVP внешние платные гео-API (Google Places и т.п.).
- Не хранить долгосрочную историю локаций пользователей (только краткий runtime state для live-сессий).
- Не реализовывать платный доступ, сложную маршрутизацию, или POI-каталогизацию на сервере.
- Не делать сложной собственной NLP-логики — генерация факта полностью делегирована модели.

## 5. Milestones & Release Plan
**Milestone 0 — Подготовка (15–30 мин)**  
- Создать бота в @BotFather, получить `TELEGRAM_TOKEN`.  
- Инициализировать репозиторий, добавить `.env.example` с нужными переменными.

**Milestone 1 — MVP реализация (45–90 мин)**  
- Простая служба (Node.js + Express или Python + FastAPI). Поддержать polling для локального dev и webhook для деплоя.  
- Парсинг `message.location`, формирование prompt, вызов OpenAI, отправка ответа пользователю.  
- Локальное тестирование в Cursor.

**Milestone 2 — Деплой (15–30 мин)**  
- Push в GitHub, деплой на Railway, настроить env vars.  
- Зарегистрировать webhook (`setWebhook`) или включить polling в продуктиве при необходимости.  
- Smoke tests: отправить локацию, проверить ответ.

**Milestone 3 — Полировка (30 мин)**  
- Добавить ссылку на карту в ответ, базовый rate limit, понятные ошибки, README с инструкцией для Cursor → GitHub → Railway.

**Milestone 4 — v1.1 Live location (потом, опционально)**  
- Поддержка `live_period` и обработка обновлений live-локации.  
- Механизм периодических заданий (каждые 10 минут) для отправки новых фактов, остановка по окончании live-периода или по `/stop`.  
- Тестирование устойчивости и защиты от спама.